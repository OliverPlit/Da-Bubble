<div class="messages">
    <ng-container *ngFor="let m of messages">

        <div class="time-separator" *ngIf="m.timeSeparator">
            <span>{{ m.timeSeparator }}</span>
        </div>

        <article class="message" *ngIf="!m.timeSeparator" [class.you]="m.isYou" #messageRef
            (mouseenter)="cancelEditMessagePanelHide(m)" (mouseleave)="scheduleEditMessagePanelHide(m)">
            <div class="avatar" [class.you]="m.isYou"
                [style.background-image]="m.avatar ? 'url(' + m.avatar + ')' : null">
                <span *ngIf="!m.avatar"></span>
            </div>

            <div class="message-body" [class.you]="m.isYou">
                <div class="meta" [class.you]="m.isYou">
                    <strong>{{ m.author }}</strong>
                    <time>{{ m.time }}</time>
                </div>

                <div class="text bubble" [class.you]="m.isYou">
                    {{ m.text }}
                </div>

                <div class="reactions" [class.you]="m.isYou" *ngIf="m.reactions?.length">
                    <div class="emoji-reactions">
                        <div class="reaction" *ngFor="let r of m.reactions" [class.active]="r.youReacted" type="button"
                            (mouseenter)="showReactionPanel(m, r, $event)" (mouseleave)="scheduleReactionPanelHide()">
                            <img class="emoji" src="{{ r.emoji }}" alt="">
                            <span class="count-emoji">{{ r.count }}</span>
                        </div>

                        <span class="icon-box">
                            <img class="default" src="icons/add_reaction.png" alt="">
                            <img class="hover" src="icons/add_reaction_purple.png" alt="">
                        </span>
                    </div>


                    <div class="response" *ngFor="let r of m.reactions">
                        <span class="count-answere">{{ r.countAnsweres }} Antworten</span>
                        <span class="answere">Letzte Antwort {{ r.time }}</span>
                    </div>
                </div>
            </div>

            <div class="reaction-panel" *ngIf="reactionPanel.show && reactionPanel.messageId === m.id"
                [style.left.px]="reactionPanel.x" [style.top.px]="reactionPanel.y"
                (mouseenter)="cancelReactionPanelHide()" (mouseleave)="scheduleReactionPanelHide()">

                <div class="panel-content">
                    <img *ngIf="reactionPanel.emoji" class="emoji" [src]="reactionPanel.emoji" alt="">
                    <div class="panel-text">
                        <div class="title">{{ reactionPanel.title }}</div>
                        <div class="subtitle">{{ reactionPanel.subtitle }}</div>
                    </div>
                </div>
            </div>

            <div class="reaction-bar" [class.you]="m.isYou">
                <span class="icon-box">
                    <img class="default" src="icons/emojis/emoji_white heavy check mark.png" alt="">
                    <img class="hover" src="icons/emojis/emoji_white heavy check mark.png" alt="">
                </span>

                <span class="icon-box">
                    <img class="default" src="icons/emojis/emoji_person raising both hands in celebration.png" alt="">
                    <img class="hover" src="icons/emojis/emoji_person raising both hands in celebration.png" alt="">
                </span>

                <span class="icon-box">
                    <img class="default" src="icons/add_reaction.png" alt="">
                    <img class="hover" src="icons/add_reaction_purple.png" alt="">
                </span>

                <span class="icon-box">
                    <img class="default" src="icons/comment.png" alt="">
                    <img class="hover" src="icons/comment_purple.png" alt="">
                </span>

                <span class="icon-box d-none" [class.you]="m.isYou" (click)="toggleEditMessagePanel(m, $event)">
                    <img class="default" src="icons/more_vert.png" alt="">
                    <img class="hover" src="icons/more_vert_purple.png" alt="">
                </span>
            </div>

            <div class="edit-message-panel" [class.you]="m.isYou" *ngIf="m.isYou && editForId === m.id"
                (click)="editMessage($event)" (mouseenter)="cancelEditMessagePanelHide(m)"
                (mouseleave)="scheduleEditMessagePanelHide(m)">
                <span>Nachricht bearbeiten</span>
            </div>
        </article>
    </ng-container>
</div>

<footer class="composer">
    <div class="composer-input">
        <textarea [(ngModel)]="draft" placeholder="Nachricht an #{{ channelName }}"></textarea>

        <div class="composer-actions">
            <div class="d-flex">
                <span class="icon-box" (click)="openAddEmojis()">
                    <img class="default" src="icons/emoji_grey.png" alt="">
                    <img class="hover1" src="icons/emoji_black.png" alt="">
                    <img class="hover2" src="icons/emoji_purple.png" alt="">
                </span>
                <span #btn2 class="icon-box" (click)="openAtMembers(btn2)">
                    <img class="default" src="icons/at_grey.png" alt="">
                    <img class="hover1" src="icons/at_black.png" alt="">
                    <img class="hover2" src="icons/at_purple.png" alt="">
                </span>
            </div>

            <div>
                <span class="icon-box" (click)="sendMessage()">
                    <img class="default" src="icons/Send icon.png" alt="">
                    <img class="hover1" src="icons/Send icon_light.png" alt="">
                </span>
            </div>
        </div>
    </div>
</footer>